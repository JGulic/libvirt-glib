# -*- rpm-spec -*-

%define with_introspection 0

%if 0%{?fedora} >= 12
%define with_introspection 1
%endif
%if 0%{?rhel} >= 6
%define with_introspection 1
%endif


Name: @PACKAGE@
Version: @VERSION@
Release: 1%{?dist}%{?extra_release}
Summary: libvirt glib integration for events
Group: Development/Libraries
License: LGPLv2+
URL: http://libvirt.org/
Source0: http://libvirt.org/%{name}/%{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

BuildRequires: glib2-devel >= 2.10.0
BuildRequires: libvirt-devel >= 0.5.0
BuildRequires: python-devel
%if %{with_introspection}
BuildRequires: gobject-introspection-devel
%if 0%{?fedora} == 12
BuildRequires: gir-repository-devel
%endif
BuildRequires: gjs-devel
%endif

%package devel
Group: Development/Libraries
Summary: libvirt glib integration for events development files

%package python
Group: Development/Libraries
Summary: libvirt glib integration for events python binding

%description
This package provides integration between libvirt and the glib
event loop.

%description devel
This package provides development header files and libraries for
integration between libvirt and the glib event loop.

%description python
This package provides a python module for integration between
libvirt and the glib event loop

%prep
%setup -q

%build

%if %{with_introspection}
%define introspection_arg --enable-introspection --with-javascript
%else
%define introspection_arg --disable-introspection --without-javascript
%endif

%configure %{introspection_arg}
%__make %{?_smp_mflags}


%install
rm -rf $RPM_BUILD_ROOT
%__make install  DESTDIR=$RPM_BUILD_ROOT
rm -f $RPM_BUILD_ROOT%{_libdir}/%{name}-1.0.a
rm -f $RPM_BUILD_ROOT%{_libdir}/%{name}-1.0.la

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,-)
%doc README COPYING AUTHORS ChangeLog NEWS
%{_libdir}/%{name}-1.0.so.*
%if %{with_introspection}
%{_libdir}/girepository-1.0/LibvirtGLib-1.0.typelib
%endif

%files devel
%defattr(-,root,root,-)
%doc examples/event-test.c
%{_libdir}/%{name}-1.0.so
%{_libdir}/pkgconfig/%{name}.pc
%{_includedir}/%{name}/%{name}.h
%{_includedir}/%{name}/%{name}-*.h
%if %{with_introspection}
%{_datadir}/gir-1.0/LibvirtGLib-1.0.gir
%endif

%files python
%defattr(-,root,root,-)
%doc examples/event-test.py
%{_libdir}/python*/site-packages/libvirtglib.py*
%{_libdir}/python*/site-packages/libvirtglibmod*

%changelog
* Sun Oct 19 2008 Daniel P. Berrange <berrange@redhat.com> - 0.0.1-1
- Initial release

